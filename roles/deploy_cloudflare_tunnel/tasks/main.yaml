- name: Create k8s namespace
  kubernetes.core.k8s:
    state: present
    kind: namespace
    name: cloudflare-tunnel
- name: Add deployment and service
  kubernetes.core.k8s:
    state: present
    definition: "{{ lookup('ansible.builtin.template', item) }}"
    wait: true
  with_items:
    - deployment.yml
  vars:
    name: cloudflared
    namespace: cloudflare-tunnel
